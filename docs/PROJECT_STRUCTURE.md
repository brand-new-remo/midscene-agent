# é¡¹ç›®æ–‡ä»¶ç»“æ„

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```
midscene/
â”‚
â”œâ”€â”€ ğŸ“„ æ ¸å¿ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ agent.py                   # LangGraph æ™ºèƒ½ä½“æ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ mcp_wrapper.py            # Midscene MCP å®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â””â”€â”€ __init__.py               # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ utils/                      # å®ç”¨å·¥å…·
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logging_utils.py          # æ—¥å¿—å·¥å…·
â”‚   â””â”€â”€ async_helpers.py          # å¼‚æ­¥è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ ğŸ“ examples/                   # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ basic_usage.py            # åŸºç¡€ä½¿ç”¨ç¤ºä¾‹
â”‚   â””â”€â”€ test_ecommerce.py         # ç”µå•†æµ‹è¯•å¥—ä»¶
â”‚
â”œâ”€â”€ ğŸ“„ å¯åŠ¨å™¨
â”‚   â”œâ”€â”€ run.py                    # äº¤äº’å¼å¿«é€Ÿå¯åŠ¨å™¨
â”‚   â””â”€â”€ setup.sh                  # è‡ªåŠ¨åˆå§‹åŒ–è„šæœ¬ï¼ˆShellï¼‰
â”‚
â”œâ”€â”€ ğŸ“„ æµ‹è¯•
â”‚   â””â”€â”€ test_compatibility.py     # å…¼å®¹æ€§æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“„ é…ç½®
â”‚   â”œâ”€â”€ requirements.txt          # Python ä¾èµ–ï¼ˆå·²å‡çº§åˆ° 1.0.0+ï¼‰
â”‚   â”œâ”€â”€ setup.py                  # åŒ…å®‰è£…é…ç½®
â”‚   â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â””â”€â”€ .gitignore               # Git å¿½ç•¥æ–‡ä»¶
â”‚
â””â”€â”€ ğŸ“š æ–‡æ¡£
    â”œâ”€â”€ README.md                 # ä¸»è¦æ–‡æ¡£
    â”œâ”€â”€ UPGRADE_GUIDE.md          # 1.0.0+ å‡çº§æŒ‡å—
    â””â”€â”€ PROJECT_STRUCTURE.md      # æœ¬æ–‡ä»¶
```

## ğŸ“‹ æ–‡ä»¶è¯¦ç»†è¯´æ˜

### ğŸ”§ æ ¸å¿ƒæ¨¡å—

#### `agent.py` (æ™ºèƒ½ä½“æ ¸å¿ƒ)
- **ç”¨é€”**: LangGraph æ™ºèƒ½ä½“çš„ä¸»è¦å®ç°
- **ä¸»è¦ç±»**: `MidsceneAgent`
- **å…³é”®æ–¹æ³•**:
  - `initialize()` - åˆå§‹åŒ– LLM å’Œ MCP è¿æ¥
  - `execute()` - æ‰§è¡Œè‡ªç„¶è¯­è¨€ä»»åŠ¡
  - `__aenter__()` / `__aexit__()` - å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- **ä¾èµ–**: LangChain 1.0.0+, LangGraph 1.0.0+
- **ç‰¹ç‚¹**: ä½¿ç”¨ `HumanMessage` æ ¼å¼å…¼å®¹ 1.0.0+

#### `mcp_wrapper.py` (MCP å°è£…)
- **ç”¨é€”**: ç®¡ç†ä¸ Midscene MCP Server çš„è¿æ¥
- **ä¸»è¦ç±»**: `MidsceneMCPWrapper`
- **å…³é”®æ–¹æ³•**:
  - `start()` - å¯åŠ¨ MCP è¿æ¥
  - `stop()` - å…³é—­è¿æ¥
  - `call_tool()` - è°ƒç”¨ MCP å·¥å…·
  - `health_check()` - å¥åº·æ£€æŸ¥
- **å¼‚å¸¸ç±»**: `MidsceneConnectionError`, `MidsceneToolError`
- **ç‰¹ç‚¹**: ä½¿ç”¨ AsyncExitStack ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸ

#### `config.py` (é…ç½®ç®¡ç†)
- **ç”¨é€”**: é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®é¡¹
- **ä¸»è¦ç±»**: `Config`
- **åŠŸèƒ½**:
  - ä»ç¯å¢ƒå˜é‡åŠ è½½é…ç½®
  - éªŒè¯é…ç½®å®Œæ•´æ€§
  - æä¾›é…ç½®å­—å…¸è¡¨ç¤º
- **é…ç½®é¡¹**:
  - DeepSeek API é…ç½®
  - Midscene é…ç½®
  - æµè§ˆå™¨é…ç½®

### ğŸ› ï¸ å·¥å…·æ¨¡å—

#### `utils/logging_utils.py`
- **å‡½æ•°**:
  - `setup_logging()` - é…ç½®æ—¥å¿—ç³»ç»Ÿ
  - `get_logger()` - è·å– logger å®ä¾‹
- **ç‰¹ç‚¹**: æ”¯æŒæ§åˆ¶å°å’Œæ–‡ä»¶åŒè¾“å‡º

#### `utils/async_helpers.py`
- **å‡½æ•°**:
  - `create_task_with_timeout()` - å¸¦è¶…æ—¶çš„ä»»åŠ¡åˆ›å»º
  - `run_with_timeout()` - å¸¦è¶…æ—¶çš„åŒæ­¥å‡½æ•°æ‰§è¡Œ
- **ç”¨é€”**: å¼‚æ­¥æ“ä½œçš„è¶…æ—¶æ§åˆ¶

### ğŸ“š ç¤ºä¾‹ä»£ç 

#### `examples/basic_usage.py`
åŒ…å«ä¸‰ä¸ªä¸»è¦ç¤ºä¾‹ï¼š
1. **basic_example()** - åŸºæœ¬çš„ Web è‡ªåŠ¨åŒ–ä»»åŠ¡
2. **interactive_example()** - äº¤äº’å¼å¤šä»»åŠ¡æ‰§è¡Œ
3. **query_example()** - é¡µé¢ä¿¡æ¯æŸ¥è¯¢ç¤ºä¾‹

#### `examples/test_ecommerce.py`
ç”µå•†æµ‹è¯•å¥—ä»¶ï¼š
1. **test_product_search()** - Amazon äº§å“æœç´¢æµ‹è¯•
2. **test_form_filling()** - httpbin.org è¡¨å•å¡«å†™æµ‹è¯•
3. **test_navigation()** - Hacker News å¯¼èˆªæµ‹è¯•
4. **run_all_tests()** - æ‰¹é‡æ‰§è¡Œæ‰€æœ‰æµ‹è¯•

### ğŸš€ å¯åŠ¨å™¨

#### `run.py` (äº¤äº’å¼å¯åŠ¨å™¨)
- **åŠŸèƒ½**: æä¾›èœå•é©±åŠ¨çš„ç¤ºä¾‹è¿è¡Œå™¨
- **ç‰¹ç‚¹**:
  - æ— éœ€è®°ä½å¤æ‚çš„ python å‘½ä»¤
  - äº¤äº’å¼èœå•é€‰æ‹©
  - å†…ç½®é…ç½®æ£€æŸ¥
  - æ”¯æŒè‡ªå®šä¹‰ä»»åŠ¡
- **ä½¿ç”¨æ–¹æ³•**: `python run.py`

#### `setup.sh` (è‡ªåŠ¨åˆå§‹åŒ–è„šæœ¬)
- **åŠŸèƒ½**: ä¸€é”®å¼ç¯å¢ƒé…ç½®
- **æ£€æŸ¥é¡¹**:
  - æ“ä½œç³»ç»Ÿå…¼å®¹æ€§
  - Python ç‰ˆæœ¬ (>= 3.10)
  - Node.js ç‰ˆæœ¬ (>= 18)
  - Chrome æµè§ˆå™¨
  - è™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
  - åŒ…å®‰è£…
  - Midscene å®‰è£…
- **ä½¿ç”¨æ–¹æ³•**: `./setup.sh`

### ğŸ§ª æµ‹è¯•

#### `test_compatibility.py` (å…¼å®¹æ€§æµ‹è¯•)
- **åŠŸèƒ½**: éªŒè¯ LangChain 1.0+ å…¼å®¹æ€§
- **æµ‹è¯•é¡¹**:
  - Python ç‰ˆæœ¬æ£€æŸ¥
  - åŒ…å¯¼å…¥éªŒè¯
  - API å…¼å®¹æ€§æµ‹è¯•
  - ç±»å®ä¾‹åŒ–æµ‹è¯•
- **ä½¿ç”¨æ–¹æ³•**: `python test_compatibility.py`
- **è¾“å‡º**: è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š

### ğŸ“¦ é…ç½®

#### `requirements.txt` (ä¾èµ–åˆ—è¡¨)
```text
langchain>=1.0.0          # âœ… å·²å‡çº§
langchain-core>=1.0.0     # âœ… å·²å‡çº§
langgraph>=1.0.0          # âœ… å·²å‡çº§
langchain-openai>=1.0.0   # âœ… å·²å‡çº§
mcp>=1.0.0
asyncio-throttle>=1.0.0
pydantic>=2.0.0
python-dotenv>=1.0.0
```

#### `setup.py` (åŒ…å®‰è£…)
- **åŠŸèƒ½**: åŒ…çš„å…ƒæ•°æ®å’Œå®‰è£…é…ç½®
- **å…¥å£ç‚¹**: `midscene-agent=run:main`
- **æ”¯æŒ**: Python >= 3.10

#### `.env.example` (ç¯å¢ƒæ¨¡æ¿)
åŒ…å«æ‰€æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼š
```bash
DEEPSEEK_API_KEY=sk-xxxxxx
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL=deepseek-chat
MIDSCENE_MODEL_NAME_NAME=doubao-seed-1.6-vision
OPENAI_API_KEY=sk-xxxxxx
```

### ğŸ“– æ–‡æ¡£

#### `README.md` (ä¸»è¦æ–‡æ¡£)
åŒ…å«ï¼š
- é¡¹ç›®æ¦‚è¿°
- æ¶æ„å›¾
- å¿«é€Ÿå¼€å§‹æŒ‡å—
- ä½¿ç”¨ç¤ºä¾‹
- é…ç½®è¯´æ˜
- æ•…éšœæ’é™¤
- æœ€ä½³å®è·µ

#### `UPGRADE_GUIDE.md` (å‡çº§æŒ‡å—)
åŒ…å«ï¼š
- 0.x åˆ° 1.0.0+ çš„å˜æ›´è¯´æ˜
- å…³é”® API å˜åŒ–
- å…¼å®¹æ€§å¤„ç†æ–¹æ¡ˆ
- å‡çº§æ­¥éª¤
- å¸¸è§é—®é¢˜è§£å†³

#### `PROJECT_STRUCTURE.md` (æœ¬æ–‡ä»¶)
- é¡¹ç›®ç»“æ„è¯´æ˜
- æ–‡ä»¶ç”¨é€”è¯¦è§£

## ğŸ¯ å¿«é€Ÿä½¿ç”¨æŒ‡å—

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨åˆå§‹åŒ–
```bash
./setup.sh
python run.py
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½®
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒ
cp .env.example .env
# ç¼–è¾‘ .env æ·»åŠ  API Key

# 3. è¿è¡Œæµ‹è¯•
python test_compatibility.py

# 4. è¿è¡Œç¤ºä¾‹
python examples/basic_usage.py
```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨
```bash
# å®‰è£…åŒ…
pip install -e .

# ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·
midscene-agent
```

## ğŸ“Š ç‰ˆæœ¬å…¼å®¹æ€§

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ | çŠ¶æ€ |
|------|----------|------|
| Python | >= 3.10 | âœ… |
| Node.js | >= 18 | âœ… |
| LangChain | >= 1.0.0 | âœ… å·²å‡çº§ |
| LangGraph | >= 1.0.0 | âœ… å·²å‡çº§ |
| Midscene | æœ€æ–°ç‰ˆ | âœ… |
| Chrome | æœ€æ–°ç‰ˆ | âœ… |

## ğŸ” æ–‡ä»¶ä¾èµ–å…³ç³»

```
run.py
â”œâ”€â”€ agent.py
â”‚   â”œâ”€â”€ mcp_wrapper.py
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ langchain_*
â”‚
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ basic_usage.py (ä¾èµ– agent.py, config.py)
â”‚   â””â”€â”€ test_ecommerce.py (ä¾èµ– agent.py, config.py)
â”‚
â”œâ”€â”€ test_compatibility.py
â”‚   â””â”€â”€ agent.py
â”‚
â””â”€â”€ utils/
    â”œâ”€â”€ logging_utils.py
    â””â”€â”€ async_helpers.py
```

## ğŸ¨ ç¼–ç è§„èŒƒ

- **Python ç‰ˆæœ¬**: 3.10+
- **ä»£ç é£æ ¼**: PEP 8
- **å¼‚æ­¥**: ä½¿ç”¨ `async/await`
- **ç±»å‹æç¤º**: ä½¿ç”¨ `typing` æ¨¡å—
- **æ–‡æ¡£å­—ç¬¦ä¸²**: Google é£æ ¼
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿—è®°å½•

## ğŸ“ˆ æ‰©å±•æ€§

ç³»ç»Ÿè®¾è®¡æ”¯æŒï¼š
- å¤šç§ LLM æä¾›å•†ï¼ˆå½“å‰ï¼šDeepSeekï¼‰
- è‡ªå®šä¹‰å·¥å…·æ‰©å±•
- æ’ä»¶åŒ–æ¶æ„
- é…ç½®çƒ­æ›´æ–°
- å¤šæµè§ˆå™¨æ”¯æŒï¼ˆé€šè¿‡ Midsceneï¼‰

---

**æœ€åæ›´æ–°**: 2024-12-02
**LangChain ç‰ˆæœ¬**: 1.0.0+
**LangGraph ç‰ˆæœ¬**: 1.0.0+
