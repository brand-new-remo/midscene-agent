# LangGraph CLI å¼€å‘æ–‡æ¡£

## æ¦‚è¿°

Midscene Agent é¡¹ç›®é›†æˆäº† LangGraph CLIï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„ç½‘é¡µè‡ªåŠ¨åŒ–å·¥å…·å¼€å‘ç¯å¢ƒã€‚é€šè¿‡ LangGraph CLIï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€ä¸æ™ºèƒ½ä½“äº¤äº’ï¼Œå®ç°æ™ºèƒ½çš„ç½‘é¡µè‡ªåŠ¨åŒ–æ“ä½œã€‚

## ç›¸å…³æ–‡ä»¶åˆ—è¡¨

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

1. **`runner/langgraph.json`** - LangGraph CLI é…ç½®æ–‡ä»¶
2. **`runner/langgraph_cli.py`** - LangGraph CLI å…¥å£ç‚¹
3. **`runner/requirements.txt`** - Python ä¾èµ–åˆ—è¡¨

### é€‚é…å™¨å±‚

4. **`runner/agent/cli_adapter.py`** - CLI é€‚é…å™¨
5. **`runner/agent/tools/langgraph_adapter.py`** - LangGraph å·¥å…·é€‚é…å™¨
6. **`runner/agent/agent.py`** - MidsceneAgent æ ¸å¿ƒå®ç°

### å·¥å…·å®šä¹‰

7. **`runner/agent/tools/definitions.py`** - å·¥å…·å®šä¹‰

### æ”¯æŒæ–‡ä»¶

8. **`runner/agent/config.py`** - é…ç½®ç®¡ç†
9. **`runner/agent/http_client.py`** - HTTP å®¢æˆ·ç«¯

---

## æ–‡ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LangGraph CLI ç”Ÿæ€ç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   langgraph.json   â”‚        â”‚   langgraph_cli.py       â”‚  â”‚
â”‚  â”‚   (é…ç½®æ–‡ä»¶)         â”‚â”€â”€â”€â”€â”€â”€â†’â”‚   (CLI å…¥å£ç‚¹)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                  â”‚
â”‚                                           â†“                  â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                   â”‚ MidsceneAgentAdapter â”‚    â”‚
â”‚                                   â”‚   (cli_adapter.py)   â”‚    â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                â”‚
â”‚                                            â†“                â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                   â”‚  MidsceneAgent      â”‚    â”‚
â”‚                                   â”‚    (agent.py)       â”‚    â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                â”‚
â”‚                                            â†“                â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                   â”‚ MidsceneHTTPClient  â”‚    â”‚
â”‚                                   â”‚  (http_client.py)   â”‚    â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                            â”‚                â”‚
â”‚                                            â†“                â”‚
â”‚                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                   â”‚  Node.js Server     â”‚    â”‚
â”‚                                   â”‚   (server/)         â”‚    â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¯¦ç»†æ–‡ä»¶è¯´æ˜

### 1. runner/langgraph.json

**ä½œç”¨**ï¼šLangGraph CLI çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰å›¾çš„å…¥å£ç‚¹å’Œä¾èµ–ã€‚

**é…ç½®å†…å®¹**ï¼š
```json
{
  "dependencies": ["."],
  "graphs": {
    "midscene_agent": "./langgraph_cli.py:graph"
  },
  "env": ".env"
}
```

**å…³é”®é…ç½®è¯´æ˜**ï¼š
- `dependencies`: ä¾èµ–çš„ Python åŒ…åˆ—è¡¨
- `graphs`: å®šä¹‰çš„å›¾å¯¹è±¡æ˜ å°„ï¼Œ`"midscene_agent"` æ˜¯å›¾åç§°ï¼Œ`"./langgraph_cli.py:graph"` æŒ‡å‘ langgraph_cli.py ä¸­çš„ graph å˜é‡
- `env`: ç¯å¢ƒå˜é‡æ–‡ä»¶è·¯å¾„

**LangGraph CLI å·¥ä½œåŸç†**ï¼š
1. CLI è¯»å– `langgraph.json` é…ç½®
2. åŠ è½½ `graphs` ä¸­å®šä¹‰çš„å›¾å¯¹è±¡
3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ http://localhost:2024ï¼‰
4. æä¾› Web UI ç•Œé¢ä¾›ç”¨æˆ·äº¤äº’

---

### 2. runner/langgraph_cli.py

**ä½œç”¨**ï¼šLangGraph CLI çš„æ ¸å¿ƒå…¥å£ç‚¹ï¼Œåˆ›å»ºå’Œé…ç½® Midscene LangGraph å›¾ã€‚

**ä¸»è¦åŠŸèƒ½**ï¼š
- åˆ›å»º LangGraph StateGraph
- å®šä¹‰ Midscene èŠ‚ç‚¹å¤„ç†é€»è¾‘
- å¯¼å‡º `graph` å˜é‡ä¾› LangGraph CLI ä½¿ç”¨

**æ ¸å¿ƒä»£ç é€»è¾‘**ï¼š

```python
def create_midscene_graph():
    """
    åˆ›å»º LangGraph CLI å…¼å®¹çš„ç¼–è¯‘å›¾
    """
    # 1. åˆ›å»ºé€‚é…å™¨
    adapter = MidsceneAgentAdapter()

    # 2. æ„å»ºçŠ¶æ€å›¾
    workflow = StateGraph(MessagesState)

    # 3. æ·»åŠ  Midscene èŠ‚ç‚¹
    async def midscene_node(state: MessagesState) -> MessagesState:
        # å¤„ç†ç”¨æˆ·æ¶ˆæ¯
        # åˆ›å»º Midscene ä¼šè¯
        # æ‰§è¡Œç”¨æˆ·è¾“å…¥
        # è¿”å›å“åº”

    # 4. æ·»åŠ èŠ‚ç‚¹å’Œè¾¹
    workflow.add_node("midscene_agent", midscene_node)
    workflow.add_edge(START, "midscene_agent")
    workflow.add_edge("midscene_agent", END)

    # 5. ç¼–è¯‘å›¾
    graph = workflow.compile()

    return graph

# å¯¼å‡º graph å˜é‡ï¼ˆLangGraph CLI è¦æ±‚ï¼‰
graph = create_midscene_graph()
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼š
   - åˆ›å»º `MidsceneAgentAdapter` å®ä¾‹
   - æ„å»º `StateGraph`ï¼ˆä½¿ç”¨ `MessagesState`ï¼‰

2. **èŠ‚ç‚¹å®šä¹‰**ï¼š
   - `midscene_node`: å¼‚æ­¥èŠ‚ç‚¹å‡½æ•°ï¼Œå¤„ç†æ‰€æœ‰ç”¨æˆ·äº¤äº’
   - æ¥æ”¶ `MessagesState` çŠ¶æ€
   - è¿”å›æ›´æ–°åçš„çŠ¶æ€

3. **æµç¨‹é…ç½®**ï¼š
   - æ·»åŠ èŠ‚ç‚¹ï¼š`workflow.add_node("midscene_agent", midscene_node)`
   - æ·»åŠ è¾¹ï¼š`START â†’ midscene_agent â†’ END`

4. **ç¼–è¯‘**ï¼š
   - è°ƒç”¨ `workflow.compile()` ç”Ÿæˆå¯æ‰§è¡Œçš„å›¾

---

### 3. runner/agent/cli_adapter.py

**ä½œç”¨**ï¼šCLI é€‚é…å™¨ï¼Œå°† MidsceneAgent åŒ…è£…ä¸º LangGraph æ ‡å‡†æ¥å£ã€‚

**æ ¸å¿ƒç±»**ï¼š`MidsceneAgentAdapter`

**ä¸»è¦èŒè´£**ï¼š
1. åŒ…è£… MidsceneAgentï¼Œæä¾›æ ‡å‡†æ¥å£
2. å¤„ç†æ¶ˆæ¯æµè½¬æ¢ï¼ˆæµå¼å“åº” â†” LangGraph æ¶ˆæ¯ï¼‰
3. ç®¡ç†ä¼šè¯ç”Ÿå‘½å‘¨æœŸ

**å…³é”®æ–¹æ³•**ï¼š

#### `__init__()`
```python
def __init__(self):
    # åˆå§‹åŒ–é…ç½®
    self.config = Config

    # åˆå§‹åŒ– MidsceneAgent
    self.agent = MidsceneAgent(
        deepseek_api_key=self.config.DEEPSEEK_API_KEY,
        deepseek_base_url=self.config.DEEPSEEK_BASE_URL,
        deepseek_model=self.config.DEEPSEEK_MODEL,
        temperature=0,
        midscene_server_url=self.config.MIDSCENE_SERVER_URL,
        tool_set="full",
        enable_websocket=True,
        timeout=300,
    )

    # ç®¡ç†æ´»è·ƒä¼šè¯
    self.active_sessions: set[str] = set()
    self.max_sessions = 50
```

#### `process(state)`
```python
async def process(self, state: Dict[str, Any]) -> AsyncGenerator[BaseMessage, None]:
    """
    å¤„ç† LangGraph æ¶ˆæ¯æµ
    - æ¥æ”¶ LangGraph çŠ¶æ€ï¼ˆåŒ…å« messagesï¼‰
    - è½¬æ¢ä¸º Midscene å¯å¤„ç†çš„æ ¼å¼
    - æ‰§è¡Œç”¨æˆ·è¾“å…¥
    - è¿”å›æµå¼å“åº”
    """
```

#### `_create_session()`
```python
async def _create_session(self) -> str:
    """
    åˆ›å»º Midscene ä¼šè¯
    1. ç¡®ä¿ HTTP å®¢æˆ·ç«¯å·²è¿æ¥
    2. åˆ›å»ºä¼šè¯é…ç½®
    3. åˆ›å»ºä¼šè¯
    4. è¿”å›ä¼šè¯ ID
    """
```

#### `_cleanup_session(session_id)`
```python
async def _cleanup_session(self, session_id: str):
    """
    æ¸…ç† Midscene ä¼šè¯
    1. å‘é€åˆ é™¤è¯·æ±‚åˆ° Node.js æœåŠ¡å™¨
    2. æ¸…ç†æœ¬åœ°ä¼šè¯è®°å½•
    """
```

**æ¶ˆæ¯è½¬æ¢æµç¨‹**ï¼š
```
LangGraph State â†’ MidsceneAgent â†’ Node.js Server
     â†“                â†“              â†“
  HumanMessage   â†’  ä»»åŠ¡æ‰§è¡Œ   â†’  ç½‘é¡µæ“ä½œ
  AIMessage      â†  å“åº”æµ     â†  ç»“æœè¿”å›
```

---

### 4. runner/agent/tools/langgraph_adapter.py

**ä½œç”¨**ï¼šå·¥å…·é€‚é…å™¨ï¼Œå°† Midscene å·¥å…·å®šä¹‰è½¬æ¢ä¸º LangGraph å…¼å®¹æ ¼å¼ã€‚

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- å°† 30+ ä¸ªå·¥å…·å®šä¹‰è½¬æ¢ä¸º `@tool` è£…é¥°å™¨æ ¼å¼
- æ”¯æŒæŒ‰åˆ†ç±»è·å–å·¥å…·ï¼ˆå¯¼èˆªã€äº¤äº’ã€æŸ¥è¯¢ã€æµ‹è¯•ï¼‰
- åˆ›å»º LangGraph ToolNode

**å…³é”®å‡½æ•°**ï¼š

#### `_adapt_tool_signature(tool_name, tool_def)`
```python
def _adapt_tool_signature(tool_name: str, tool_def: Dict[str, Any]):
    """
    å°†å·¥å…·å®šä¹‰é€‚é…ä¸º @tool è£…é¥°å™¨æ ¼å¼
    1. æå–å·¥å…·æè¿°å’Œå‚æ•°
    2. æ„å»ºå®Œæ•´æè¿°æ–‡æ¡£
    3. ä½¿ç”¨ @tool è£…é¥°å™¨åˆ›å»ºå·¥å…·
    4. è®¾ç½®å·¥å…·åç§°å’Œæè¿°
    """
```

**å·¥å…·åˆ†ç±»**ï¼š
1. **å¯¼èˆªå·¥å…·** (TOOL_CATEGORY_NAVIGATION)
   - `midscene_navigate`: å¯¼èˆªåˆ° URL
   - `midscene_setActiveTab`: åˆ‡æ¢æ ‡ç­¾é¡µ

2. **äº¤äº’å·¥å…·** (TOOL_CATEGORY_INTERACTION)
   - `midscene_aiTap`: AI ç‚¹å‡»
   - `midscene_aiInput`: AI è¾“å…¥
   - `midscene_aiScroll`: AI æ»šåŠ¨
   - `midscene_aiHover`: AI æ‚¬åœ
   - `midscene_aiKeyboardPress`: é”®ç›˜æ“ä½œ
   - `midscene_aiWaitFor`: æ™ºèƒ½ç­‰å¾…

3. **æŸ¥è¯¢å·¥å…·** (TOOL_CATEGORY_QUERY)
   - `midscene_aiAssert`: éªŒè¯
   - `midscene_aiQuery`: æå–æ•°æ®
   - `midscene_aiAsk`: AI æŸ¥è¯¢
   - `midscene_aiBoolean`: å¸ƒå°”å€¼
   - `midscene_aiString`: å­—ç¬¦ä¸²å€¼
   - `midscene_aiNumber`: æ•°å€¼
   - `midscene_location`: è·å–ä½ç½®
   - `midscene_screenshot`: æˆªå›¾
   - `midscene_getConsoleLogs`: æ§åˆ¶å°æ—¥å¿—

4. **æµ‹è¯•å·¥å…·** (TOOL_CATEGORY_TEST)
   - è‡ªå®šä¹‰æµ‹è¯•å·¥å…·

#### `create_langgraph_tools()`
```python
def create_langgraph_tools() -> List:
    """
    åˆ›å»º LangGraph å…¼å®¹çš„å·¥å…·åˆ—è¡¨
    éå†æ‰€æœ‰ TOOL_DEFINITIONS
    ä¸ºæ¯ä¸ªå·¥å…·åˆ›å»º @tool è£…é¥°çš„å‡½æ•°
    è¿”å› LangChain å·¥å…·åˆ—è¡¨
    """
```

#### `create_tool_node()`
```python
def create_tool_node():
    """
    åˆ›å»º ToolNode
    ä½¿ç”¨ LangGraph çš„é¢„æ„å»º ToolNode
    ä¼ å…¥å·¥å…·åˆ—è¡¨
    """
```

---

### 5. runner/agent/agent.py

**ä½œç”¨**ï¼šMidsceneAgent æ ¸å¿ƒå®ç°ï¼Œé›†æˆ LangGraph å’Œ DeepSeek LLMã€‚

**æ ¸å¿ƒç±»**ï¼š`MidsceneAgent`

**æ¶æ„**ï¼š
```
MidsceneAgent
    â”œâ”€â”€ LLM (DeepSeek)
    â”œâ”€â”€ LangGraph (StateGraph)
    â”œâ”€â”€ Tools (30+ ä¸ª)
    â”œâ”€â”€ HTTP Client
    â””â”€â”€ WebSocket (æµå¼å“åº”)
```

**ä¸»è¦ç»„ä»¶**ï¼š

1. **LLM** (`ChatDeepSeek`)
   - ä½¿ç”¨ DeepSeek æ¨¡å‹è¿›è¡Œæ¨ç†
   - é…ç½®æ¸©åº¦å‚æ•°ï¼ˆé»˜è®¤ 0ï¼‰

2. **LangGraph æ‰§è¡Œå™¨**
   - `StateGraph(MessagesState)`
   - `ToolNode` (å·¥å…·è°ƒç”¨)
   - `tools_condition` (å·¥å…·é€‰æ‹©)

3. **HTTP å®¢æˆ·ç«¯** (`MidsceneHTTPClient`)
   - ä¸ Node.js æœåŠ¡å™¨é€šä¿¡
   - REST API è°ƒç”¨
   - WebSocket è¿æ¥

4. **å·¥å…·é›†**
   - ä» `definitions.py` åŠ è½½å·¥å…·
   - æ”¯æŒ `basic`ã€`advanced`ã€`full` ä¸‰ç§é…ç½®

**åˆå§‹åŒ–æµç¨‹**ï¼š
```python
async def initialize(self):
    """
    åˆå§‹åŒ–æ™ºèƒ½ä½“
    1. è¿æ¥ HTTP å®¢æˆ·ç«¯
    2. åˆå§‹åŒ– LLM
    3. åŠ è½½å·¥å…·
    4. åˆ›å»º LangGraph æ‰§è¡Œå™¨
    5. æ ‡è®° initialized = True
    """
```

**æ‰§è¡Œæµç¨‹**ï¼š
```python
async def execute(self, user_input: str, stream: bool = True):
    """
    æ‰§è¡Œç”¨æˆ·è¾“å…¥
    1. éªŒè¯åˆå§‹åŒ–çŠ¶æ€
    2. ä¼ å…¥ user_input å’Œ stream å‚æ•°
    3. è°ƒç”¨ agent_executor.astream()
    4. è¿”å›æµå¼å“åº”
    """
```

---

### 6. runner/agent/tools/definitions.py

**ä½œç”¨**ï¼šå£°æ˜å¼å·¥å…·å®šä¹‰ï¼Œé›†ä¸­ç®¡ç†æ‰€æœ‰å¯ç”¨å·¥å…·ã€‚

**å·¥å…·åˆ†ç±»å¸¸é‡**ï¼š
```python
TOOL_CATEGORY_NAVIGATION = "navigation"
TOOL_CATEGORY_INTERACTION = "interaction"
TOOL_CATEGORY_QUERY = "query"
TOOL_CATEGORY_TEST = "test"
```

**TOOL_DEFINITIONS ç»“æ„**ï¼š
```python
TOOL_DEFINITIONS = {
    "tool_name": {
        "description": "å·¥å…·æè¿°",
        "params": {
            "param1": "å‚æ•°è¯´æ˜",
            "param2?": "å¯é€‰å‚æ•°è¯´æ˜"
        },
        "category": "åˆ†ç±»",
        "required": True/False
    },
    ...
}
```

**ä¸»è¦å·¥å…·ç¤ºä¾‹**ï¼š

**å¯¼èˆªå·¥å…·**ï¼š
- `midscene_navigate`: å¯¼èˆªåˆ° URL

**äº¤äº’å·¥å…·**ï¼š
- `midscene_aiTap`: AI æ™ºèƒ½ç‚¹å‡»
- `midscene_aiInput`: AI æ™ºèƒ½è¾“å…¥
- `midscene_aiScroll`: AI æ»šåŠ¨
- `midscene_aiHover`: AI æ‚¬åœ
- `midscene_aiKeyboardPress`: é”®ç›˜æ“ä½œ
- `midscene_aiWaitFor`: æ™ºèƒ½ç­‰å¾…

**æŸ¥è¯¢å·¥å…·**ï¼š
- `midscene_aiAssert`: éªŒè¯é¡µé¢æ¡ä»¶
- `midscene_aiQuery`: æå–ç»“æ„åŒ–æ•°æ®
- `midscene_aiAsk`: AI æŸ¥è¯¢é¡µé¢
- `midscene_aiBoolean`: è·å–å¸ƒå°”å€¼
- `midscene_aiString`: è·å–å­—ç¬¦ä¸²å€¼
- `midscene_aiNumber`: è·å–æ•°å€¼
- `midscene_aiLocate`: è·å–å…ƒç´ ä½ç½®
- `midscene_location`: è·å–å½“å‰ URL/æ ‡é¢˜
- `midscene_screenshot`: æˆªå±
- `midscene_getTabs`: è·å–æ ‡ç­¾é¡µåˆ—è¡¨
- `midscene_getConsoleLogs`: è·å–æ§åˆ¶å°æ—¥å¿—

---

### 7. runner/agent/config.py

**ä½œç”¨**ï¼šé…ç½®ç®¡ç†ï¼Œå®šä¹‰æ‰€æœ‰ç¯å¢ƒå˜é‡å’Œé»˜è®¤å€¼ã€‚

**ä¸»è¦é…ç½®é¡¹**ï¼š
```python
class Config:
    # DeepSeek LLM é…ç½®
    DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY")
    DEEPSEEK_BASE_URL = "https://api.deepseek.com/v1"
    DEEPSEEK_MODEL = "deepseek-chat"

    # Midscene æœåŠ¡å™¨é…ç½®
    MIDSCENE_SERVER_URL = "http://localhost:3000"

    # å…¶ä»–é…ç½®
    LOG_LEVEL = "INFO"
    TIMEOUT = 300
```

---

### 8. runner/requirements.txt

**ä½œç”¨**ï¼šPython ä¾èµ–åˆ—è¡¨ã€‚

**æ ¸å¿ƒä¾èµ–**ï¼š
```
# LangGraph and LangChain
langchain>=1.0.0
langchain-core>=1.0.0
langgraph>=1.0.0
langchain-deepseek>=1.0.0

# HTTP Client
aiohttp>=3.9.0

# Async support
asyncio-throttle>=1.0.0

# Utilities
pydantic>=2.0.0
python-dotenv>=1.0.0
```

---

## æ‰§è¡Œæµç¨‹è¯¦è§£

### å®Œæ•´æ‰§è¡Œé“¾è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LangGraph CLI æ‰§è¡Œæµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  1. å¯åŠ¨é˜¶æ®µ                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ $ langgraph dev                      â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ è¯»å– langgraph.json                  â”‚                    â”‚
â”‚  â”‚ - dependencies: ["."]                â”‚                    â”‚
â”‚  â”‚ - graphs: {                          â”‚                    â”‚
â”‚  â”‚   "midscene_agent":                  â”‚                    â”‚
â”‚  â”‚     "./langgraph_cli.py:graph"       â”‚                    â”‚
â”‚  â”‚ }                                   â”‚                    â”‚
â”‚  â”‚ - env: ".env"                       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ åŠ è½½ graph å˜é‡                      â”‚                    â”‚
â”‚  â”‚ - è°ƒç”¨ create_midscene_graph()       â”‚                    â”‚
â”‚  â”‚ - åˆ›å»º StateGraph(MessagesState)     â”‚                    â”‚
â”‚  â”‚ - æ·»åŠ  midscene_node                 â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ å¯åŠ¨ Web UI (http://localhost:2024)   â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                              â”‚
â”‚  2. ç”¨æˆ·äº¤äº’é˜¶æ®µ                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤                  â”‚                    â”‚
â”‚  â”‚ ä¾‹å¦‚: "æ‰“å¼€ç™¾åº¦ï¼Œæœç´¢ AI"             â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ LangGraph å¤„ç†                      â”‚                    â”‚
â”‚  â”‚ - åˆ›å»º MessagesState                â”‚                    â”‚
â”‚  â”‚ - æ·»åŠ  HumanMessage                 â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ è°ƒç”¨ midscene_node                  â”‚                    â”‚
â”‚  â”‚ - æ¥æ”¶ MessagesState                â”‚                    â”‚
â”‚  â”‚ - æå–ç”¨æˆ·æ¶ˆæ¯                      â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ MidsceneAgentAdapter å¤„ç†            â”‚                    â”‚
â”‚  â”‚ - æ£€æŸ¥ä¼šè¯æ•°é™åˆ¶                    â”‚                    â”‚
â”‚  â”‚ - åˆ›å»º Midscene ä¼šè¯                â”‚                    â”‚
â”‚  â”‚ - è°ƒç”¨ agent.execute()              â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ MidsceneAgent æ‰§è¡Œ                  â”‚                    â”‚
â”‚  â”‚ - åˆå§‹åŒ– (å¦‚æœéœ€è¦)                 â”‚                    â”‚
â”‚  â”‚ - LLM æ¨ç† (DeepSeek)               â”‚                    â”‚
â”‚  â”‚ - é€‰æ‹©å·¥å…·                          â”‚                    â”‚
â”‚  â”‚ - è°ƒç”¨å·¥å…·                          â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ HTTP å®¢æˆ·ç«¯é€šä¿¡                      â”‚                    â”‚
â”‚  â”‚ - å‘é€ REST API è¯·æ±‚                â”‚                    â”‚
â”‚  â”‚ - æ¥æ”¶ JSON å“åº”                    â”‚                    â”‚
â”‚  â”‚ - WebSocket æµå¼ä¼ è¾“                â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Node.js æœåŠ¡å™¨å¤„ç†                   â”‚                    â”‚
â”‚  â”‚ - Midscene.js æ‰§è¡Œ                  â”‚                    â”‚
â”‚  â”‚ - Playwright æ§åˆ¶æµè§ˆå™¨             â”‚                    â”‚
â”‚  â”‚ - æ‰§è¡Œç½‘é¡µè‡ªåŠ¨åŒ–æ“ä½œ                 â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ è¿”å›ç»“æœ                            â”‚                    â”‚
â”‚  â”‚ - Node.js â†’ Python                  â”‚                    â”‚
â”‚  â”‚ - Python â†’ LangGraph                â”‚                    â”‚
â”‚  â”‚ - LangGraph â†’ Web UI                â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚              â†“                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ æ¸…ç†èµ„æº                            â”‚                    â”‚
â”‚  â”‚ - åˆ é™¤ Midscene ä¼šè¯                â”‚                    â”‚
â”‚  â”‚ - é‡Šæ”¾æµè§ˆå™¨èµ„æº                    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶ˆæ¯æµè½¬æ¢

```
ç”¨æˆ·è¾“å…¥: "æ‰“å¼€ç™¾åº¦ï¼Œæœç´¢ AI"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LangGraph      â”‚         â”‚  Adapter         â”‚         â”‚ MidsceneAgent   â”‚
â”‚  MessagesState  â”‚         â”‚  (cli_adapter)   â”‚         â”‚ (agent.py)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ messages: [     â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚   HumanMessage( â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ user_input =     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ execute()       â”‚
â”‚     content:    â”‚         â”‚ "æ‰“å¼€ç™¾åº¦ï¼Œæœç´¢   â”‚         â”‚                 â”‚
â”‚     "æ‰“å¼€ç™¾åº¦ï¼Œ  â”‚         â”‚  AI"             â”‚         â”‚ astream()       â”‚
â”‚      æœç´¢ AI"   â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚   )             â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚ ]               â”‚         â”‚                  â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LangGraph      â”‚         â”‚  Adapter         â”‚         â”‚ MidsceneAgent   â”‚
â”‚  MessagesState  â”‚         â”‚  (cli_adapter)   â”‚         â”‚ (agent.py)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ messages: [     â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚   HumanMessage( â”‚         â”‚                  â”‚         â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚     content:    â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚     "æ‰“å¼€ç™¾åº¦ï¼Œ  â”‚         â”‚                  â”‚         â”‚ chunk = {...}   â”‚
â”‚      æœç´¢ AI"   â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚   ),            â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚   AIMessage(    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”‚ response =       â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”‚                 â”‚
â”‚     content:    â”‚         â”‚ chunk            â”‚         â”‚                 â”‚
â”‚     "æ­£åœ¨æ‰“å¼€   â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚      ç™¾åº¦..."   â”‚         â”‚ yield AIMessage()â”‚         â”‚                 â”‚
â”‚   )             â”‚         â”‚                  â”‚         â”‚                 â”‚
â”‚ ]               â”‚         â”‚                  â”‚         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨ LangGraph å¼€å‘æœåŠ¡å™¨

```bash
# 1. ç¡®ä¿å·²å®‰è£…ä¾èµ–
cd runner
pip install -r requirements.txt

# 2. ç¡®ä¿ Node.js æœåŠ¡å™¨è¿è¡Œ
cd ../server
npm start

# 3. é…ç½®ç¯å¢ƒå˜é‡
cd ../runner
cp .env.example .env
# ç¼–è¾‘ .envï¼Œè®¾ç½® DEEPSEEK_API_KEY ç­‰

# 4. å¯åŠ¨ LangGraph å¼€å‘æœåŠ¡å™¨
langgraph dev

# 5. è®¿é—® Web UI
# æµè§ˆå™¨æ‰“å¼€: http://localhost:2024
```

### ä½¿ç”¨ Web UI

1. **æ‰“å¼€æµè§ˆå™¨**ï¼šè®¿é—® http://localhost:2024
2. **é€‰æ‹©å›¾**ï¼šåœ¨ç•Œé¢ä¸­é€‰æ‹© `midscene_agent`
3. **è¾“å…¥æŒ‡ä»¤**ï¼šåœ¨å¯¹è¯æ¡†ä¸­è¾“å…¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š
   - "æ‰“å¼€ https://www.baidu.com"
   - "åœ¨æœç´¢æ¡†è¾“å…¥ 'äººå·¥æ™ºèƒ½'"
   - "ç‚¹å‡»æœç´¢æŒ‰é’®"
   - "éªŒè¯æœç´¢ç»“æœæ˜¯å¦æ˜¾ç¤º"
4. **æŸ¥çœ‹ç»“æœ**ï¼šå®æ—¶æŸ¥çœ‹æ‰§è¡Œè¿‡ç¨‹å’Œç»“æœ

### ç¤ºä¾‹å¯¹è¯

```
ç”¨æˆ·: "æ‰“å¼€ç™¾åº¦é¦–é¡µ"
åŠ©æ‰‹:
âœ… æ­£åœ¨å¯¼èˆªåˆ° https://www.baidu.com
ğŸ“ å½“å‰é¡µé¢: https://www.baidu.com
ğŸ“¸ æˆªå›¾å·²ä¿å­˜

ç”¨æˆ·: "åœ¨æœç´¢æ¡†è¾“å…¥ 'äººå·¥æ™ºèƒ½'"
åŠ©æ‰‹:
âœ… æ‰¾åˆ°æœç´¢æ¡†: "ç™¾åº¦ä¸€ä¸‹"
âœ… è¾“å…¥æ–‡æœ¬: "äººå·¥æ™ºèƒ½"
âœ… è¾“å…¥å®Œæˆ

ç”¨æˆ·: "ç‚¹å‡»æœç´¢æŒ‰é’®"
åŠ©æ‰‹:
âœ… æ‰¾åˆ°æŒ‰é’®: "ç™¾åº¦ä¸€ä¸‹"
âœ… ç‚¹å‡»å®Œæˆ
ğŸ” ç­‰å¾…æœç´¢ç»“æœ...

ç”¨æˆ·: "éªŒè¯é¡µé¢æ˜¯å¦æ˜¾ç¤ºæœç´¢ç»“æœ"
åŠ©æ‰‹:
âœ… æ‰¾åˆ°æœç´¢ç»“æœ
âœ… éªŒè¯é€šè¿‡: é¡µé¢åŒ…å«å¤šä¸ªæœç´¢ç»“æœé“¾æ¥
âœ… æœç´¢ç»“æœæ ‡é¢˜åŒ…æ‹¬: "äººå·¥æ™ºèƒ½_ç™¾åº¦ç™¾ç§‘"ã€"äººå·¥æ™ºèƒ½ï¼ˆArtificial Intelligenceï¼‰"ç­‰
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)

```bash
# DeepSeek LLM é…ç½® (å¿…éœ€)
DEEPSEEK_API_KEY=sk-xxxxx
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# Midscene æœåŠ¡å™¨é…ç½®
MIDSCENE_SERVER_URL=http://localhost:3000

# å…¶ä»–é…ç½®
LOG_LEVEL=INFO
TIMEOUT=300
```

### LangGraph CLI é…ç½®

åœ¨ `langgraph.json` ä¸­å¯ä»¥è‡ªå®šä¹‰ï¼š

```json
{
  "dependencies": ["."],
  "graphs": {
    "midscene_agent": "./langgraph_cli.py:graph"
  },
  "env": ".env"
}
```

**è‡ªå®šä¹‰é…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "dependencies": ["."],
  "graphs": {
    "my_agent": "./custom_cli.py:my_graph"
  },
  "env": ".env"
}
```

---

## æ¶æ„ä¼˜åŠ¿

### 1. è§£è€¦è®¾è®¡
- **Python ç«¯**ï¼šLLM æ¨ç†ã€å·¥å…·é€‰æ‹©ã€ä¼šè¯ç®¡ç†
- **Node.js ç«¯**ï¼šæµè§ˆå™¨æ§åˆ¶ã€ç½‘é¡µè‡ªåŠ¨åŒ–
- **é€šä¿¡åè®®**ï¼šHTTP + WebSocket

### 2. å¯æ‰©å±•æ€§
- å·¥å…·å®šä¹‰é›†ä¸­ç®¡ç†ï¼Œæ˜“äºæ·»åŠ æ–°å·¥å…·
- é€‚é…å™¨æ¨¡å¼ï¼Œæ–¹ä¾¿é›†æˆæ–°æ¡†æ¶
- æ¨¡å—åŒ–è®¾è®¡ï¼Œç»„ä»¶å¯å¤ç”¨

### 3. ç¨³å®šæ€§
- ä¼šè¯éš”ç¦»ï¼Œæ“ä½œäº’ä¸å½±å“
- å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†
- é‡è¯•æœºåˆ¶å’Œè¶…æ—¶æ§åˆ¶

### 4. æ˜“ç”¨æ€§
- è‡ªç„¶è¯­è¨€äº¤äº’
- å®æ—¶æµå¼å“åº”
- Web UI å¯è§†åŒ–ç•Œé¢

---

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. ç«¯å£ 2024 è¢«å ç”¨**
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
lsof -ti:2024 | xargs kill

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
langgraph dev --port 2025
```

**2. DeepSeek API å¯†é’¥æ— æ•ˆ**
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env | grep DEEPSEEK_API_KEY

# æµ‹è¯• API è¿æ¥
curl -H "Authorization: Bearer $DEEPSEEK_API_KEY" \
     https://api.deepseek.com/v1/models
```

**3. Node.js æœåŠ¡å™¨æœªå¯åŠ¨**
```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:3000/api/health

# å¯åŠ¨æœåŠ¡å™¨
cd server
npm start
```

**4. Python ä¾èµ–ç¼ºå¤±**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# æˆ–å‡çº§ä¾èµ–
pip install --upgrade -r requirements.txt
```

### è°ƒè¯•æŠ€å·§

**å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

**æŸ¥çœ‹ WebSocket è¿æ¥**ï¼š
- æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- åˆ‡æ¢åˆ° Network é¢æ¿
- ç­›é€‰ ws://localhost:2024

**æ£€æŸ¥ Midscene ä¼šè¯**ï¼š
```bash
# åˆ—å‡ºæ´»åŠ¨ä¼šè¯
curl http://localhost:3000/api/sessions

# æŸ¥çœ‹ä¼šè¯å†å²
curl http://localhost:3000/api/sessions/{session_id}/history
```

---

## æ€»ç»“

Midscene Agent çš„ LangGraph CLI é›†æˆæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ç½‘é¡µè‡ªåŠ¨åŒ–å¼€å‘ç¯å¢ƒï¼š

1. **é…ç½®æ–‡ä»¶é©±åŠ¨**ï¼šé€šè¿‡ `langgraph.json` ç®€å•é…ç½®
2. **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œç»„ä»¶åˆ’åˆ†
3. **å·¥å…·ä¸°å¯Œ**ï¼š30+ ä¸ªä¸“ä¸šå·¥å…·è¦†ç›–å„ç§åœºæ™¯
4. **å¼€å‘å‹å¥½**ï¼šWeb UI ç•Œé¢å’Œå®æ—¶åé¦ˆ
5. **ç”Ÿäº§å°±ç»ª**ï¼šå¼‚å¸¸å¤„ç†ã€èµ„æºæ¸…ç†ã€å¹¶å‘æ§åˆ¶

é€šè¿‡è¿™ä¸ªç³»ç»Ÿï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿæ„å»ºæ™ºèƒ½çš„ç½‘é¡µè‡ªåŠ¨åŒ–åº”ç”¨ï¼Œå®ç°ä»è‡ªç„¶è¯­è¨€åˆ°ç½‘é¡µæ“ä½œçš„ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–ã€‚

---

## é™„å½•ï¼šå·¥å…·åˆ—è¡¨

### å¯¼èˆªå·¥å…· (4ä¸ª)
- `midscene_navigate` - å¯¼èˆªåˆ° URL
- `midscene_setActiveTab` - åˆ‡æ¢æ ‡ç­¾é¡µ
- `midscene_goBack` - è¿”å›ä¸Šä¸€é¡µ
- `midscene_reload` - åˆ·æ–°é¡µé¢

### äº¤äº’å·¥å…· (6ä¸ª)
- `midscene_aiTap` - AI æ™ºèƒ½ç‚¹å‡»
- `midscene_aiInput` - AI æ™ºèƒ½è¾“å…¥
- `midscene_aiScroll` - AI é¡µé¢æ»šåŠ¨
- `midscene_aiHover` - AI æ‚¬åœ
- `midscene_aiKeyboardPress` - é”®ç›˜æ“ä½œ
- `midscene_aiWaitFor` - æ™ºèƒ½ç­‰å¾…

### æŸ¥è¯¢å·¥å…· (15ä¸ª)
- `midscene_aiAssert` - éªŒè¯æ¡ä»¶
- `midscene_aiQuery` - æå–æ•°æ®
- `midscene_aiAsk` - AI æŸ¥è¯¢
- `midscene_aiBoolean` - å¸ƒå°”å€¼
- `midscene_aiString` - å­—ç¬¦ä¸²å€¼
- `midscene_aiNumber` - æ•°å€¼
- `midscene_aiLocate` - å…ƒç´ ä½ç½®
- `midscene_location` - å½“å‰ä½ç½®
- `midscene_screenshot` - æˆªå›¾
- `midscene_getTabs` - æ ‡ç­¾é¡µåˆ—è¡¨
- `midscene_getConsoleLogs` - æ§åˆ¶å°æ—¥å¿—
- `midscene_getPageSource` - é¡µé¢æºç 
- `midscene_getPageTitle` - é¡µé¢æ ‡é¢˜
- `midscene_getUrl` - å½“å‰ URL
- `midscene_waitForLoad` - ç­‰å¾…åŠ è½½å®Œæˆ

### æµ‹è¯•å·¥å…· (5ä¸ª)
- `midscene_runTest` - è¿è¡Œæµ‹è¯•
- `midscene_assertElement` - æ–­è¨€å…ƒç´ 
- `midscene_assertText` - æ–­è¨€æ–‡æœ¬
- `midscene_assertVisible` - æ–­è¨€å¯è§
- `midscene_assertCount` - æ–­è¨€æ•°é‡

**æ€»è®¡ï¼š30ä¸ªå·¥å…·**

æ¯ä¸ªå·¥å…·éƒ½æ”¯æŒ AI æ™ºèƒ½å®šä½å’Œè‡ªç„¶è¯­è¨€æè¿°ï¼Œå¤§å¤§é™ä½äº†ç½‘é¡µè‡ªåŠ¨åŒ–çš„ä½¿ç”¨é—¨æ§›ã€‚