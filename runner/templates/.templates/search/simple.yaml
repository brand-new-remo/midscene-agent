# 简单搜索模板
# 适用于基本的网页搜索场景

template:
  name: "简单搜索模板"
  version: "1.0.0"
  description: "通用网页搜索流程，支持基本搜索和结果展示"
  category: "search"
  tags: ["search", "basic"]
  author: "system"

  parameters:
    keyword:
      type: "string"
      required: true
      description: "搜索关键词"
    search_url:
      type: "url"
      required: false
      description: "搜索页面URL"
      default: "${app.base_url}/search"
    result_count:
      type: "number"
      required: false
      description: "期望的结果数量"
      default: 10
    filter_type:
      type: "string"
      required: false
      description: "筛选类型（如最新、最热等）"
      choices: ["最新", "最热", "相关", "默认"]
      default: "默认"

  context:
    # 默认选择器（可以覆盖）
    search_selector: "input[name='q'], input[id='search'], input[placeholder*='搜索'], input[placeholder*='请输入']"
    submit_selector: "button[type='submit'], .search-btn, .btn-search, button:contains('搜索')"
    result_selector: ".search-result, .result-item, .item, [class*='result']"

  steps:
    # 步骤 1: 导航到搜索页面
    - id: "navigate"
      action: "ai"
      params:
        prompt: "导航到搜索页面 ${search_url}，等待页面完全加载"
      description: "导航到搜索页面"

    # 步骤 2: 输入搜索关键词
    - id: "input_keyword"
      action: "aiInput"
      params:
        locate: "搜索框"
        value: "${keyword}"
      description: "输入搜索关键词"

    # 步骤 3: 点击搜索按钮或按回车
    - id: "click_search"
      action: "aiTap"
      params:
        locate: "搜索按钮"
      description: "点击搜索按钮"

    # 步骤 4: 等待搜索结果加载
    - id: "wait_results"
      action: "aiWaitFor"
      params:
        assertion: "等待搜索结果页面加载完成，检查是否显示搜索结果"
        timeoutMs: 30000
      description: "等待搜索结果"

    # 步骤 5: 验证搜索结果页面
    - id: "verify_results"
      action: "aiAssert"
      params:
        assertion: "验证搜索结果页面显示正常，检查是否有关键词相关的结果"
      description: "验证搜索结果"

    # 步骤 6: 提取搜索结果
    - id: "extract_results"
      action: "aiQuery"
      params:
        name: "search_results"
        prompt: "提取前${result_count}个搜索结果的标题、链接和摘要信息"
        options:
          domIncluded: true
          screenshotIncluded: false
      description: "提取搜索结果数据"

    # 步骤 7: 可选的筛选
    - id: "apply_filter"
      action: "aiTap"
      params:
        locate: "${filter_type}筛选选项, ${filter_type}排序"
      condition: "${filter_type} != '默认'"
      description: "应用筛选条件"

  post_steps:
    # 截图记录
    - id: "screenshot"
      action: "logScreenshot"
      params:
        title: "搜索结果 - ${keyword}"
        content: "关键词 '${keyword}' 的搜索结果截图，共 ${result_count} 条结果"
      description: "截取搜索结果"
